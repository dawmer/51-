C51 COMPILER V9.60.0.0   DA_AD                                                             11/13/2022 12:00:04 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DA_AD
OBJECT MODULE PLACED IN DA-AD.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ËÄÂ·²É¼¯´®¿ÚÏÔÊ¾\DA-AD.C OPTIMIZE(8,SPEED) BROWSE INCDIR(.\ËÄÂ·²É¼¯´®¿ÚÏ
                    -ÔÊ¾) DEBUG OBJECTEXTEND PRINT(.\DA-AD.lst) OBJECT(DA-AD.obj)

line level    source

   1          
   2          /*********************************************************************************
   3          * ¡¾±àÐ´Ê±¼ä¡¿£º 2011.07.07
   4          * ¡¾×÷    Õß¡¿£º Ñãôáµç×Ó
   5          * ¡¾°æ    ±¾¡¿£º V1.0
   6          * ¡¾Íø    Õ¾¡¿£º http://ylelectronic.taobao.com/ 
   7          * ¡¾Q      Q¡¿£º 348439350
   8          * ¡¾Éù    Ã÷¡¿£º ´Ë³ÌÐò½öÓÃÓÚÑ§Ï°Óë²Î¿¼£¬ÒýÓÃÇë×¢Ã÷°æÈ¨ºÍ×÷ÕßÐÅÏ¢£¡
   9          * ¡¾º¯Êý¹¦ÄÜ¡¿£º DA-ADÊÔÑé                                                                                  
  10          * ¡¾Ê¹ÓÃËµÃ÷¡¿£º µ¥Æ¬»ú£ºSTC89C52 
  11                           ´®¿Ú²¨ÌØÂÊ£º9600
  12                                           ´®¿ÚÒ»¹²·¢ËÍ4¸ö×Ö½Ú  
  13                                           1 ¹âÃôµç×è
  14                                           2 ÈÈÃôµç×è
  15                                           3 Ðü¿Õ
  16                                           4 ¿Éµ÷0-5VµçÑ¹£¨À¶É«µçÎ»Æ÷µ÷½Ú£©
  17                                           
  18          **********************************************************************************/
  19          /********************************************************************************************/
  20          
  21          #include<reg52.h>    //°üº¬µ¥Æ¬»ú¼Ä´æÆ÷µÄÍ·ÎÄ¼þ
  22          #include <I2C.H>
  23          
  24          #define uchar unsigned char
  25          #define  PCF8591 0x90    //PCF8591 µØÖ·
  26          
  27          
  28          
  29          // ±äÁ¿¶¨Òå
  30          unsigned char AD_CHANNEL=3;
  31          
  32          unsigned int  D[5];
  33          
  34          sbit P2_0 = P2^0;
  35          sbit P2_1 = P2^1;
  36          sbit P2_2 = P2^2;
  37          sbit P2_3 = P2^3;
  38          
  39          unsigned char date;
  40          
  41          //uchar code table[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,
  42           //                       0xf8,0x80,0x90};
  43          
  44          
  45            // º¯ÊýÉêÃ÷ 
  46          
  47          void display();
  48          bit DACconversion(unsigned char sla,unsigned char c,  unsigned char Val);
  49          bit ISendByte(unsigned char sla,unsigned char c);
  50          unsigned char IRcvByte(unsigned char sla);
  51          
  52          //******************************************************************/
  53          void PCF8591init()
  54          {  
C51 COMPILER V9.60.0.0   DA_AD                                                             11/13/2022 12:00:04 PAGE 2   

  55   1       
  56   1              
  57   1                  switch(AD_CHANNEL)
  58   1                      {
  59   2                              case 0: ISendByte(PCF8591,0x41);
  60   2                                   D[0]=IRcvByte(PCF8591);  //ADC0 Ä£Êý×ª»»1      ¹âÃôµç×è
  61   2                                       break;  
  62   2                              
  63   2                              case 1: ISendByte(PCF8591,0x42);
  64   2                                   D[1]=IRcvByte(PCF8591);  //ADC1  Ä£Êý×ª»»2   ÈÈÃôµç×è
  65   2                                       break;  
  66   2                              
  67   2                              case 2: ISendByte(PCF8591,0x43);
  68   2                                   D[2]=IRcvByte(PCF8591);  //ADC2    Ä£Êý×ª»»3          Ðü¿Õ
  69   2                                       break;  
  70   2                              
  71   2                              case 3: ISendByte(PCF8591,0x40);
  72   2                                   D[3]=IRcvByte(PCF8591);  //ADC3   Ä£Êý×ª»»4           ¿Éµ÷0-5v
  73   2                                       break;  
  74   2                              
  75   2                              case 4: DACconversion(PCF8591,0x40, D[4]); //DAC          ÊýÄ£×ª»»
  76   2                                   break;
  77   2                       
  78   2                      }
  79   1      }
  80          /*******************************************************************
  81          DAC ±ä»», ×ª»¯º¯Êý               
  82          *******************************************************************/
  83          bit DACconversion(unsigned char sla,unsigned char c,  unsigned char Val)
  84          {
  85   1         Start_I2c();              //Æô¶¯×ÜÏß
  86   1         SendByte(sla);            //·¢ËÍÆ÷¼þµØÖ·
  87   1         if(ack==0)return(0);
  88   1         SendByte(c);              //·¢ËÍ¿ØÖÆ×Ö½Ú
  89   1         if(ack==0)return(0);
  90   1         SendByte(Val);            //·¢ËÍDACµÄÊýÖµ  
  91   1         if(ack==0)return(0);
  92   1         Stop_I2c();               //½áÊø×ÜÏß
  93   1         return(1);
  94   1      }
  95          
  96          /*******************************************************************
  97          ADC·¢ËÍ×Ö½Ú[ÃüÁî]Êý¾Ýº¯Êý               
  98          *******************************************************************/
  99          bit ISendByte(unsigned char sla,unsigned char c)
 100          {
 101   1         Start_I2c();              //Æô¶¯×ÜÏß
 102   1         SendByte(sla);            //·¢ËÍÆ÷¼þµØÖ·
 103   1         if(ack==0)return(0);
 104   1         SendByte(c);              //·¢ËÍÊý¾Ý
 105   1         if(ack==0)return(0);
 106   1         Stop_I2c();               //½áÊø×ÜÏß
 107   1         return(1);
 108   1      }
 109          
 110          /*******************************************************************
 111          ADC¶Á×Ö½ÚÊý¾Ýº¯Êý               
 112          *******************************************************************/
 113          unsigned char IRcvByte(unsigned char sla)
 114          {  unsigned char c;
 115   1      
 116   1         Start_I2c();          //Æô¶¯×ÜÏß
C51 COMPILER V9.60.0.0   DA_AD                                                             11/13/2022 12:00:04 PAGE 3   

 117   1         SendByte(sla+1);      //·¢ËÍÆ÷¼þµØÖ·
 118   1         if(ack==0)return(0);
 119   1         c=RcvByte();          //¶ÁÈ¡Êý¾Ý0
 120   1      
 121   1         Ack_I2c(1);           //·¢ËÍ·Ç¾Í´ðÎ»
 122   1         Stop_I2c();           //½áÊø×ÜÏß
 123   1         return(c);
 124   1      }
 125          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    210    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
